<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Full Project | Congestion Prediction in IC Design using Graph Neural Network </title> <meta name="author" content="DSC 180 B07 Congestion Prediction in IC Design using Graph Neural Network"> <meta name="description" content="A growing collection of your cool projects."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/DSC180-Website/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/DSC180-Website/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/DSC180-Website/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%95%B8&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/DSC180-Website/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://m1tong.github.io/DSC180-Website/project/"> <link defer rel="stylesheet" href="/DSC180-Website/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/DSC180-Website/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/DSC180-Website/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/DSC180-Website/assets/js/distillpub/template.v2.js"></script> <script src="/DSC180-Website/assets/js/distillpub/transforms.v2.js"></script> <script src="/DSC180-Website/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "Congestion Prediction in IC Design using Graph Neural Network",
            "description": "A growing collection of your cool projects.",
            "published": "March 16, 2024",
            "authors": [
              
              {
                "author": "Michelle Tong",
                "authorURL": "https://m1tong.github.io/",
                "affiliations": [
                  {
                    "name": "HDSI, UCSD",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Yuyang Pang",
                "authorURL": "https://www.linkedin.com/in/yuyang-pang-667285241/",
                "affiliations": [
                  {
                    "name": "HDSI, UCSD",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Hang Liu",
                "authorURL": "https://www.linkedin.com/in/hang-liu-2b4b371aa/",
                "affiliations": [
                  {
                    "name": "HDSI, UCSD",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Vivian Chen",
                "authorURL": "https://www.linkedin.com/in/vnchen01/",
                "affiliations": [
                  {
                    "name": "HDSI, UCSD",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Lindsey Kostas",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Qualcomm Inc.",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Guillaume Shippee",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Qualcomm Inc.",
                    "url": ""
                  }
                ]
              },
              
              {
                "author": "Lea Hagen",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "Qualcomm Inc.",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/DSC180-Website//"> Congestion Prediction in IC Design using Graph Neural Network </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/DSC180-Website/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/DSC180-Website/project/">Full Project <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/DSC180-Website/repositories/">Repositories </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Congestion Prediction in IC Design using Graph Neural Network</h1> <p>A growing collection of your cool projects.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#introduction">Introduction</a> </div> <div> <a href="#methodology">Methodology</a> </div> <ul> <li> <a href="#dataset">Dataset</a> </li> <li> <a href="#feature-selection-and-engineering">Feature Selection and Engineering</a> </li> </ul> <div> <a href="#graph-neural-network">Graph Neural Network</a> </div> <ul> <li> <a href="#gcn-model">GCN Model</a> </li> <li> <a href="#gat-model">GAT Model</a> </li> <li> <a href="#grc-based-prediction-model">GRC-Based Prediction Model</a> </li> </ul> <div> <a href="#results">Results</a> </div> <ul> <li> <a href="#node-based-models">Node-Based Models</a> </li> <li> <a href="#grc-based-models">GRC-Based Models</a> </li> </ul> <div> <a href="#conclusion">Conclusion</a> </div> </nav> </d-contents> <h2 id="introducion">Introducion</h2> <p>Predicting congestion in IC design is a critical yet challenging task. Congestion occurs when excessive wiring or routing is required in certain regions of the chip layout, often resulting from suboptimal floor planning or high cell density. This can lead to significant issues, such as timing discrepancies, crosstalk, increased power consumption, reduced reliability, and high production costs. Early prediction and mitigation of congestion are thus essential to avoid these complications.</p> <p>Current optimization tools for calculating congestion are extremely time-consuming given the complexity of modern chips. A machine learning model that utilizes the existing information of netlists and their congestion can accelerate the optimization process in IC design. Predicting congestion is generally complex due to the intricate nature of IC layouts. This project seeks to address this challenge by leveraging Graph Neural Networks (GNNs), which hold promise due to their ability to model complex relationships and interactions in graph-structured data.</p> <p>Related Work: The approach of using graph neural networks in congestion prediction has been explored in recent works. Kirby et al. utilized deep Graph Attention Networks on the hypergraph representation of IC designs to predict congestion <d-cite key="Kirby2019CongestionNet"></d-cite>. This graph neural network-based approach has outperformed existing methods of congestion prediction by accuracy and speed. Moreover, GNNs can predict congestion on a per-cell level and don’t require any placement information.</p> <p>Given the advantages of GNNs in circuit congestion prediction, our project aims to explore similar GNN architectures from Kirby et al.’s work on the NCSU-DigIC-GraphData dataset and compare the performance of different GNN architectures. NCSU-DigIC-GraphData has a much smaller scale compared to the netlists used in Kirby et al.’s paper, which has roughly 50 million cells from tens of designs. Experimenting with graph neural networks on different sizes of netlists can give us insights into how well GNNs scale and how different GNN architectures perform on a smaller-scale dataset.</p> <hr> <h2 id="methodology">Methodology</h2> <h3 id="dataset">Dataset</h3> <p>This project utilizes the NCSU-DigIC-GraphData, which comprises 13 netlists, each exhibiting unique placement and congestion characteristics. For each netlist, the dataset contains node features, node connectivity, and Global Route Cell (GRC) based demand and capacity. GRCs are organized in a rectangular grid (Figure 1), but not all GRCs have the same dimensions.</p> <div class="table-2" style="text-align:center;"> <img src="/DSC180-Website//assets/img/Nodes_and_GRCs.png" alt="Table for Dataset Statistic" style="width:100%; max-width:200px;"> <img src="/DSC180-Website//assets/img/congestion.png" alt="Table for Dataset Statistic" style="width:50%; max-width:200px;"> </div> <div class="figure-1" style="display: flex; justify-content: center;"> <div style="flex: 1; margin-right: 10px;"> <img src="/DSC180-Website//assets/img/Nodes_and_GRCs.png" alt="Nodes and GRC" style="width: 80%; max-width: 200px;"> <p>Figure 1a: </p> </div> <div style="flex: 1; margin-left: 10px;"> <img src="/DSC180-Website//assets/img/congestion.png" alt="Congestion in GRC" style="width: 50%; max-width: 200px;"> <p>Figure 1b:</p> </div> </div> <p>For each netlist, the dataset contains node features, node connectivity, and GRC based congestion (demand minus capacity). Node features and node connectivity refer to the characteristics and interconnections of individual elements within the netlist. GRC-based congestion calculates congestion at a GRC index with multiple nodes.</p> <div class="table-1" style="text-align:center;"> <img src="/DSC180-Website//assets/img/table1_data_summary.png" alt="Table for Dataset Statistic" style="width:100%; max-width:500px;"> <p style="font-size: smaller;">Table 1: Dataset'details &amp; statistics. 1st column in the table shows the name of each netlist, 2nd-4th column show the number of cells, edge, and effective layers in each netlist, 5th-8th columns show the distribution of edge per cells for each netlist and 9th-12th columns show the distribution of congestions for each netlist. </p> </div> <h3 id="feature-selection-and-engineering">Feature Selection and Engineering</h3> <p>Selecting node features is essential for training the Graph Neural Network (GNN). The dataset gives basic node features, including the locations of nodes, the dimensions of the cells, and their orientations, as detailed below:</p> <ul> <li> <p><strong>xloc and yloc</strong>: The locations of nodes (<em>xloc</em> and <em>yloc</em>) provide the relative positions for the model to learn where congestion typically occurs within the chip layout.</p> </li> <li> <p><strong>width and height</strong>: Utilizing the size of the nodes, specifically the width and height of the cells, serves as a convenient method to encode the cell type directly into the model, offering insights into the physical space occupied by each element.</p> </li> <li> <p><strong>orient</strong>: The orientation of the cells might indicate the preferred direction of routing, offering a hint towards potential congestion areas.</p> </li> </ul> <p>Besides the existing node features, some related features are calculated and assigned to each node.</p> <ul> <li> <p><strong>cell density</strong>: The number of cells inside each GRC. By assigning cell densities to nodes, the model can use them to reference how congested different areas are.</p> </li> <li> <p><strong>input and output degrees</strong>: The number of connections a node has to other nodes. It serves as critical routing information and helps with the prediction task.</p> </li> <li> <p><strong>GRC Indexes</strong>: Unique x and y index for each GRC. Even though xloc and yloc already encode the spatial information of nodes, GRC indexes can provide extra references for the model to understand the spatial relationships of nodes.</p> </li> </ul> <p>To examine the correlation between these features and demand/congestion. We calculated the Pearson correlation coefficients (Table \ref{tab:corr}). In the table, we removed height and orientation because all cells have the same height and orientation is not ordinal. The correlation coefficients indicate an association between selected features and targeted congestion.</p> <p>As one can observe, the correlation between congestion and demand is very high (0.778). As stated before, congestion is defined as (demand - capacity). In other words, the existence of demand is what causes congestion, which explains why the correlation between these two variables is notably high. Therefore, we will consider the idea of constructing a model that predicts demand instead of congestion.</p> <p>To ensure our model’s robustness across various designs, feature normalization is performed. The <em>xloc</em>, <em>yloc</em>, <em>width</em>, and <em>height</em> values are normalized before being fed into the model, allowing it to generalize across designs with differing dimensions. The orientation feature (<em>orient</em>) is encoded using one-hot encoding to capture its categorical nature effectively.</p> <p>Additionally, connectivity data is transformed into an Edge Index using the adjacency matrix, an important step for enabling the GNN to understand the connections between nodes. This Edge Index serves as a key input, allowing the network to learn the intricate relationships and pathways within the graph structure.</p> <p>Congestion/Demand data, combined from all layers, is mapped to each node based on the Global Route Cell (GRC) boundaries. Congestion can be computed as the difference between demand and capacity, providing a quantitative measure of congestion at each node.</p> <hr> <h2 id="graph-neural-network">Graph Neural Network</h2> <p>Our project employs Graph Convolutional Network (GCN) and Graph Attention Network (GAT) architectures.</p> <h3 id="gcn-model">GCN Model</h3> <p>GCN models utilize the graph-based structure of circuit designs, where nodes represent circuit components, and edges denote connections between these components. The model utilizes spatial dependencies between components to predict congestion by encoding both local and global structures of the circuit.</p> <p>Architecture Details:</p> <ul> <li> <p><strong>Node Feature Encoding:</strong> Each node $v_i$ in the circuit graph $G(V,E)$ is associated with a feature vector $x_i$ that represents the physical properties of the circuit components, such as size, orientation, and connectivity.</p> </li> <li> <p><strong>Graph Convolution Layers:</strong> The model comprises multiple graph convolution layers. Each layer transforms the node features into higher-level representations. A graph convolution layer is defined as:</p> \[H^{(l+1)} = \sigma(\tilde{D}^{-\frac{1}{2}} \tilde{A} \tilde{D}^{-\frac{1}{2}} H^{(l)} W^{(l)})\] <p>where $H^{(l)}$ is the matrix of node features at layer $l$, $\tilde{A} = A + I$ is the adjacency matrix $A$ with added self-loops $I$, $\tilde{D}$ is the degree matrix of $\tilde{A}$, $W^{(l)}$ is the weight matrix for layer $l$, and $\sigma$ denotes a nonlinear activation function such as ReLU. This equation is given by Kipf et al. [1].</p> </li> <li> <p><strong>Pooling and Readout:</strong> After several graph convolution layers, a global pooling layer aggregates the node features to capture the overall graph structure. The readout layer maps these aggregated features to congestion predictions.</p> </li> </ul> <h3 id="gat-model">GAT Model</h3> <p>To refine the model’s capability in capturing intricate dependencies between circuit components, we incorporate a Graph Attention Network (GAT) layer, which assigns varying importance to different nodes within a neighborhood. The equations below are derived from Veličković et al. <d-cite key="veličković2018graph"></d-cite>.</p> <p>Architecture Details:</p> <ul> <li> <p><strong>Attention Mechanism:</strong> The GAT layer computes attention coefficients for node pairs, indicating the importance of node $j$’s features to node $i$:</p> \[\alpha_{ij} = \frac{\exp(\text{LeakyReLU}(\mathbf{a}^\top[W h_i \| W h_j]))}{\sum_{k \in N_i} \exp(\text{LeakyReLU}(\mathbf{a}^\top[W h_i \| W h_k]))}\] <p>where $h_i$ and $h_j$ are the feature vectors of nodes $i$ and $j$, respectively, $W$ is a shared weight matrix, $\mathbf{a}$ is the attention mechanism’s weight vector, and $N_i$ denotes the neighbors of node $i$.</p> </li> <li> <p><strong>Multi-head Attention:</strong> To stabilize the learning process, we employ multi-head attention, where $K$ independent attention mechanisms execute in parallel, and their features are concatenated. This leads to the following representation for each node:</p> \[\text{MultiHead}(h_i) = \big\|_{k=1}^K \sigma \left( \sum_{j \in N_i} \alpha_{ij}^k W^k h_j \right)\] <p>where $\big|_{k=1}^K$ denotes concatenation of the outputs from $K$ attention heads.</p> </li> <li> <p><strong>Integration into GCN:</strong> The GAT layers are integrated with the GCN framework, allowing the model to leverage both the structured feature propagation of GCNs and the adaptive attention mechanism of GATs for enhanced congestion prediction.</p> </li> </ul> <h3 id="grc-based-prediction-model">GRC-Based Prediction Model</h3> <p>Since the demand and capacity data is stored per GRC, predicting congestion per GRC may have better performance compared to predicting congestion per node. Furthermore, per node prediction fails to predict congestion for GRCs that are empty. Therefore, we decide to test a GRC-based model architecture alongside with node-based model.</p> <p>To utilize GNNs, we treat each GRC as a node and compute GRC features and GRC edge index. GRC features are the averages of node features in each GRC. Empty GRCs are imputed using their neighbors’ features. GRC edge index is derived from the node edge index. Duplicate edges are retained to preserve the connectivity information between GRCs.</p> <hr> <h2 id="results">Results</h2> <h3 id="node-based-models">Node-Based Models</h3> <p>By training the GCN model on one netlist (Xbar_1) that contains 3952 nodes, it reached a training loss of 75.368 and a test loss of 82.583. From Figure <code class="language-plaintext highlighter-rouge">GCN_loss</code>, we can tell that the training and validation loss decreased exponentially and are healthy.</p> <p>When we plotted the scatterplots of ground truth demand and predicted demand (Figure <code class="language-plaintext highlighter-rouge">GCN_pred_scat</code>), we found that our model tends to predict the mean of the congestion. This may be due to the MSE loss function we used. It reflects that the model failed to capture the relationship between node features, connectivity, and demand.</p> <p>On the other hand, the GAT model reached a training loss of 15.083 and a test loss of 13.418. Moreover, Pearson’s correlation coefficient for the predicted demand and ground truth is 0.472 for the GAT model, much higher than the correlation coefficient of the GCN model (0.005). To test our models’ robustness, we separately trained the GCN and GAT models on every design and calculated the RMSE, Pearson’s r, Kendell’s Tau B on the test sets.</p> <p>Table <code class="language-plaintext highlighter-rouge">model_results</code> contains model performance on single designs and cross designs settings. The performance of a naive mean predictor is also included to serve as a reference for model performance. Generally, GATs have lower RMSE and higher Pearson and Kendall in both single-design training and cross-design training compared to GCNs.</p> <h3 id="grc-based-models">GRC-Based Models</h3> <p>We experimented with a per GRC prediction model using a GAT model because we believed GRC-based models may have the lowest MSE given the nature of how demand is stored in the dataset. However, the prediction has the worst correlation coefficient with the ground truth (-0.0855) compared to cell-based models. Figure <code class="language-plaintext highlighter-rouge">GRC_pred_scat</code> shows the prediction has no patterns at all. This might be caused by a lack of node features in the GRC-based models.</p> <hr> <h2 id="conclusion">Conclusion</h2> <p>In this project, we have tested both GCN and GAT models on the NCSU-DigIC-GraphData dataset. We discovered that models trained on one netlist are not robust and tend to vary a lot in terms of MSE and Correlation Coefficient. We compared GAT’s performance on a single design and multiple designs and observed better results than GCN models. However, we noticed that GAT can take more time to train compared to GCN models if we increase the number of heads in the attention mechanisms. Node-based models are superior to GRC-based models based on their performance and robustness. Overall, GCN models perform worse than a naive mean predictor, while GAT models are slightly better than a naive mean predictor, indicting the poor scalability of GNN models on small netlists.</p> <hr> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/DSC180-Website/assets/bibliography/2018-12-22-distill.bib"></d-bibliography> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 DSC 180 B07 Congestion Prediction in IC Design using Graph Neural Network. </div> </footer> <script src="/DSC180-Website/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>